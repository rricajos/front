<!doctype html>
<html lang="es" data-theme="dark">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Avatar Gespropiedad</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Asistente virtual interactivo de Gespropiedad">
  <meta name="theme-color" content="#1ca4af">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Avatar">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-16.png">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  
  <!-- Styles -->
  <link rel="stylesheet" href="./css/styles.css">
  
  <!-- Lucide Icons (defer para no bloquear) -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js" defer></script>
</head>

<body>
  <!-- App Loader -->
  <div class="app-loader" id="appLoader">
    <svg class="loader-logo" viewBox="0 0 226.1 219.1" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="loaderGrad1" x1="56" y1="178.7" x2="56" y2="0" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#1ca4af"/><stop offset="1" stop-color="#1c3768"/>
        </linearGradient>
        <linearGradient id="loaderGrad2" x1="139.2" y1="53.5" x2="232.6" y2="215.2" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#1ca4af"/><stop offset="1" stop-color="#1c3768"/>
        </linearGradient>
      </defs>
      <polygon fill="url(#loaderGrad1)" points="0 0 73.6 111 26.2 178.7 65.6 178.7 111.9 109.9 41.8 0 0 0"/>
      <polygon fill="url(#loaderGrad2)" points="194.6 45.6 150.2 111 226 219 186.7 219 111.9 109.9 152.9 45.6 194.6 45.6"/>
    </svg>
    <div class="loader-spinner"></div>
    <p class="loader-text">Cargando avatar...</p>
  </div>

  <div class="start-overlay" id="startOverlay">
    <svg class="start-logo" viewBox="0 0 226.1 219.1" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="grad1" x1="56" y1="178.7" x2="56" y2="0" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#1ca4af"/><stop offset="1" stop-color="#1c3768"/>
        </linearGradient>
        <linearGradient id="grad2" x1="139.2" y1="53.5" x2="232.6" y2="215.2" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#1ca4af"/><stop offset="1" stop-color="#1c3768"/>
        </linearGradient>
      </defs>
      <polygon fill="url(#grad1)" points="0 0 73.6 111 26.2 178.7 65.6 178.7 111.9 109.9 41.8 0 0 0"/>
      <polygon fill="url(#grad2)" points="194.6 45.6 150.2 111 226 219 186.7 219 111.9 109.9 152.9 45.6 194.6 45.6"/>
    </svg>
    <h1>Asistente Virtual</h1>
    <p>Conexia Telecom 路 Gestpropiedad</p>
    <div class="start-buttons">
      <button class="start-btn" id="startPresentationBtn"><i data-lucide="tv"></i>Modo Presentaci贸n</button>
      <button class="start-btn secondary" id="startNormalBtn"><i data-lucide="settings-2"></i>Panel de Control</button>
    </div>
    <button class="start-btn install-overlay hidden" id="installAppBtn"><i data-lucide="download"></i>Instalar App</button>
  </div>

  <div class="presentation-container" id="presentationContainer">
    <button class="exit-presentation-btn" id="exitPresentationBtn" title="Salir (ESC)"><i data-lucide="x"></i></button>
    <div class="presentation-avatar" id="presentationAvatar">
      <div class="pres-rive-wrap">
        <div class="rive-skeleton" id="presentationSkeleton">
          <div class="skeleton-avatar"></div>
        </div>
        <canvas id="presentationCanvas" width="800" height="800"></canvas>
      </div>
    </div>
    <img src="./gestpropiedad.jpg" alt="GestPropiedad" class="presentation-logo">
    <div class="presentation-subtitle" id="presentationSubtitle"></div>
    <!-- Progress Bar -->
    <div class="presentation-progress" id="presentationProgress">
      <div class="progress-info">
        <span class="progress-text" id="progressText">1 / 4</span>
        <span class="progress-title" id="progressTitle">Bienvenida</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
  </div>

  <!-- Contenedor Principal -->
  <div class="main-container">
    <div class="stage">
    <!-- Columna Izquierda: Avatar -->
    <div class="avatar-column">
      <div class="avatar-status">
        <div class="status-bar">
          <span class="status-dot loading" id="statusDot"></span>
          <span class="status-text" id="statusText">Inicializando...</span>
        </div>
        <div class="debug" id="debug"></div>
      </div>
      
      <div class="avatar">
        <div class="rive-wrap" id="riveWrap">
          <div class="rive-skeleton" id="panelSkeleton">
            <div class="skeleton-avatar"></div>
          </div>
          <button class="fullscreen-btn" id="fullscreenBtn" title="Pantalla completa"><i data-lucide="maximize-2"></i></button>
          <canvas id="riveCanvas" width="600" height="600"></canvas>
        </div>
        <div class="css-avatar" id="cssAvatar">
          <div class="head">
            <div class="eye left"><div class="pupil"></div></div>
            <div class="eye right"><div class="pupil"></div></div>
            <div class="mouth" id="cssMouth"></div>
          </div>
        </div>
      </div>
      
      <div class="avatar-actions">
        <button class="btn primary full-width" id="enterPresentationBtn"><i data-lucide="tv"></i>Modo Presentaci贸n</button>
      </div>
    </div>

    <!-- Columna Derecha: TTS -->
    <div class="voice-column">
      <div class="tts-status">
        <span class="tts-status-dot" id="ttsStatusDot"></span>
        <span class="tts-status-text" id="ttsStatusText">TTS: Cargando...</span>
      </div>
      
      <textarea class="text-input" id="textInput" placeholder="Escribe un texto para probar la voz..." aria-label="Texto para sintetizar">Hola, soy el asistente virtual de Gespropiedad. 驴En qu茅 puedo ayudarte hoy?</textarea>
      
      <div class="btn-row" role="group" aria-label="Controles de reproducci贸n">
        <button class="btn primary" id="playPauseBtn" aria-label="Reproducir texto"><i data-lucide="play" aria-hidden="true"></i><span>Reproducir</span></button>
        <button class="btn" id="replayBtn" aria-label="Reiniciar reproducci贸n"><i data-lucide="rotate-ccw" aria-hidden="true"></i><span>Reiniciar</span></button>
      </div>
      
      <!-- Solo selector de voz -->
      <div class="voice-settings" role="group" aria-label="Configuraci贸n de voz">
        <div class="setting-row">
          <label for="ttsProviderSelectPanel">Proveedor</label>
          <select id="ttsProviderSelectPanel" class="voice-select" aria-label="Seleccionar proveedor de voz">
            <option value="elevenlabs">锔 ElevenLabs</option>
            <option value="browser"> Navegador</option>
          </select>
        </div>
        <div class="setting-row" id="voicePickerPanel">
          <label for="voiceSelectPanel">Voz</label>
          <select id="voiceSelectPanel" class="voice-select" disabled aria-label="Seleccionar voz">
            <option value="">Cargando...</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Secci贸n de Ajustes (debajo de las columnas) -->
  <div class="settings-bar" role="region" aria-label="Ajustes de la aplicaci贸n">
    <div class="settings-bar-grid">
      <!-- Opciones -->
      <div class="settings-card">
        <div class="settings-card-header">
          <i data-lucide="sliders" aria-hidden="true"></i>
          <span>Opciones</span>
        </div>
        <div class="settings-card-content">
          <div class="setting-row">
            <label for="subtitlesToggleMain">Subt铆tulos</label>
            <label class="toggle">
              <input type="checkbox" id="subtitlesToggleMain" checked aria-label="Activar subt铆tulos">
              <span class="toggle-slider" aria-hidden="true"></span>
            </label>
          </div>
          <div class="setting-row">
            <label for="soundToggleMain">Sonido</label>
            <label class="toggle">
              <input type="checkbox" id="soundToggleMain" checked aria-label="Activar sonido">
              <span class="toggle-slider" aria-hidden="true"></span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Apariencia -->
      <div class="settings-card">
        <div class="settings-card-header">
          <i data-lucide="palette" aria-hidden="true"></i>
          <span>Apariencia</span>
        </div>
        <div class="settings-card-content">
          <div class="setting-row">
            <label id="themeLabel">Tema</label>
            <div class="theme-pills" role="group" aria-labelledby="themeLabel">
              <button class="theme-pill" data-theme="light" title="Claro" aria-label="Tema claro"><i data-lucide="sun" aria-hidden="true"></i></button>
              <button class="theme-pill active" data-theme="dark" title="Oscuro" aria-label="Tema oscuro" aria-pressed="true"><i data-lucide="moon" aria-hidden="true"></i></button>
              <button class="theme-pill" data-theme="system" title="Sistema" aria-label="Tema del sistema"><i data-lucide="monitor" aria-hidden="true"></i></button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Aplicaci贸n -->
      <div class="settings-card">
        <div class="settings-card-header">
          <i data-lucide="smartphone" aria-hidden="true"></i>
          <span>Aplicaci贸n</span>
        </div>
        <div class="settings-card-content">
          <div class="setting-row" id="installRowMain">
            <label>Instalar</label>
            <button class="mini-btn" id="installBtnMain" title="Instalar PWA" aria-label="Instalar aplicaci贸n">
              <i data-lucide="download" aria-hidden="true"></i>
            </button>
          </div>
          <div class="setting-row">
            <label>Cach茅</label>
            <button class="mini-btn" id="clearCacheBtnMain" title="Limpiar cach茅" aria-label="Limpiar cach茅 de la aplicaci贸n">
              <i data-lucide="trash-2" aria-hidden="true"></i>
            </button>
          </div>
          <div class="setting-row">
            <label>Versi贸n</label>
            <span class="version-tag">2.0.0</span>
          </div>
          <div class="setting-row">
            <label>Consola</label>
            <button class="mini-btn" id="debugConsoleBtn" title="Abrir consola de depuraci贸n" aria-label="Abrir consola de depuraci贸n">
              <i data-lucide="terminal" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div> <!-- cierra main-container -->

  <!-- Ajustes M贸vil (visible solo en m贸vil) -->
  <div class="mobile-settings" id="mobileSettings">
    <h3><i data-lucide="settings"></i>Ajustes</h3>
    
    <div class="mobile-settings-grid">
      <div class="mobile-setting-item">
        <label><i data-lucide="type"></i>Subt铆tulos</label>
        <label class="toggle">
          <input type="checkbox" id="mobileSubtitlesToggle" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
      
      <div class="mobile-setting-item">
        <label><i data-lucide="volume-2"></i>Sonido</label>
        <label class="toggle">
          <input type="checkbox" id="mobileSoundToggle" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
      
      <div class="mobile-setting-item">
        <label><i data-lucide="sun"></i>Tema</label>
        <div class="theme-toggle-mobile">
          <button class="theme-btn-mobile" data-theme="dark" title="Oscuro"><i data-lucide="moon"></i></button>
          <button class="theme-btn-mobile" data-theme="light" title="Claro"><i data-lucide="sun"></i></button>
          <button class="theme-btn-mobile active" data-theme="system" title="Sistema"><i data-lucide="monitor"></i></button>
        </div>
      </div>
      
      <div class="mobile-setting-item volume-control">
        <label><i data-lucide="volume-1"></i>Volumen</label>
        <input type="range" id="mobileVolumeSlider" min="0" max="100" value="80" class="volume-slider">
        <span class="volume-value" id="mobileVolumeValue">80%</span>
      </div>
    </div>
  </div>

  <script type="module" src="./js/main.js"></script>
</body>
</html>
